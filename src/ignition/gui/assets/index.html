<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>iGnition</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app">

    <!-- Sidebar -->
    <aside id="sidebar">

      <div class="race-btn-wrap">
        <button class="race-btn" id="race-btn">
          <img src="car-steering-wheel-svgrepo-com.svg" class="race-wheel-icon" width="15" height="15" alt="" />
          Race
        </button>
      </div>

      <div class="pause-btn-wrap">
        <button class="pause-btn" id="pause-btn" title="Pause monitoring">
          <svg class="pause-icon" viewBox="0 0 16 16" fill="none" width="13" height="13">
            <rect x="3" y="2" width="3.5" height="12" rx="1" fill="currentColor"/>
            <rect x="9.5" y="2" width="3.5" height="12" rx="1" fill="currentColor"/>
          </svg>
          <svg class="resume-icon" viewBox="0 0 16 16" fill="none" width="13" height="13" style="display:none">
            <path d="M4 2l10 6-10 6V2z" fill="currentColor"/>
          </svg>
          <span class="pause-label">Pause</span>
        </button>
      </div>

      <nav class="nav">
        <button class="nav-item active" data-page="apps">
          <svg class="nav-icon" viewBox="0 0 20 20" fill="none">
            <rect x="2" y="2" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.5"/>
            <rect x="11" y="2" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.5"/>
            <rect x="2" y="11" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.5"/>
            <rect x="11" y="11" width="7" height="7" rx="1.5" stroke="currentColor" stroke-width="1.5"/>
          </svg>
          <span>Apps</span>
          <span class="nav-badge" id="apps-count-badge" style="display:none">0</span>
        </button>
        <button class="nav-item" data-page="profiles">
          <svg class="nav-icon" viewBox="0 0 20 20" fill="none">
            <circle cx="10" cy="6" r="3.5" stroke="currentColor" stroke-width="1.5"/>
            <path d="M3 17c0-3.314 3.134-6 7-6s7 2.686 7 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>Profiles</span>
        </button>
        <button class="nav-item" data-page="settings">
          <svg class="nav-icon" viewBox="0 0 20 20" fill="none">
            <circle cx="10" cy="10" r="2.5" stroke="currentColor" stroke-width="1.5"/>
            <path d="M10 2v2M10 16v2M2 10h2M16 10h2M4.22 4.22l1.42 1.42M14.36 14.36l1.42 1.42M4.22 15.78l1.42-1.42M14.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>Settings</span>
        </button>
        <button class="nav-item" data-page="log">
          <svg class="nav-icon" viewBox="0 0 20 20" fill="none">
            <path d="M3 5h14M3 9h10M3 13h12M3 17h7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
          <span>Log</span>
          <span class="nav-badge" id="log-count-badge" style="display:none">0</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <div class="status-pill" id="status-pill">
          <span class="status-dot" id="status-dot"></span>
          <span class="status-text" id="status-text">Offline</span>
        </div>
        <div class="session-timer" id="session-timer" style="display:none">
          <span class="session-timer-label">Session</span>
          <span class="session-timer-value" id="session-timer-value">0:00:00</span>
        </div>

        <div class="theme-switcher">
          <button class="theme-btn active" data-theme="dark">Dark</button>
          <button class="theme-btn" data-theme="iracing">iRacing</button>
        </div>

        <button class="quit-btn" id="quit-btn">
          <svg viewBox="0 0 20 20" fill="none" width="13" height="13">
            <path d="M8 3H4a1 1 0 00-1 1v12a1 1 0 001 1h4M13 14l3-4-3-4M16 10H7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Quit iGnition
        </button>
      </div>
    </aside>

    <!-- Main content -->
    <main id="main">

      <!-- Apps page -->
      <section class="page active" id="page-apps">
        <div class="page-header">
          <div>
            <h1>Apps</h1>
            <div class="page-profile-line" id="active-profile-line" style="display:none"></div>
            <p>Applications launched when iRacing starts. Can be stopped automatically when iRacing closes.</p>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <input type="search" id="apps-search" class="input apps-search" placeholder="Filter apps…" />
            <div class="view-toggle">
              <button class="view-btn active" data-view="card" id="view-card-btn" title="Card view">
                <svg viewBox="0 0 16 16" fill="none" width="13" height="13"><rect x="1" y="1" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.4"/><rect x="9" y="1" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.4"/><rect x="1" y="9" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.4"/><rect x="9" y="9" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.4"/></svg>
              </button>
              <button class="view-btn" data-view="compact" id="view-compact-btn" title="List view">
                <svg viewBox="0 0 16 16" fill="none" width="13" height="13"><path d="M2 4h12M2 8h12M2 12h12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
              </button>
            </div>
            <button class="btn" id="template-picker-btn">
              <svg viewBox="0 0 16 16" fill="none" width="14" height="14"><path d="M2 3h5v5H2zM9 3h5v5H9zM2 9h5v5H2zM9 9h5v5H9z" stroke="currentColor" stroke-width="1.4" stroke-linejoin="round"/></svg>
              Popular Apps
            </button>
            <button class="btn btn-primary" id="add-app-btn">
              <svg viewBox="0 0 16 16" fill="none" width="14" height="14"><path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
              Add App
            </button>
          </div>
        </div>
        <div class="apps-list" id="apps-list"></div>
        <div class="empty-state" id="apps-empty" style="display:none">
          <div class="empty-icon">
            <svg viewBox="0 0 48 48" fill="none" width="40" height="40" opacity=".35"><rect x="6" y="6" width="15" height="15" rx="3" stroke="currentColor" stroke-width="2"/><rect x="27" y="6" width="15" height="15" rx="3" stroke="currentColor" stroke-width="2"/><rect x="6" y="27" width="15" height="15" rx="3" stroke="currentColor" stroke-width="2"/><rect x="27" y="27" width="15" height="15" rx="3" stroke="currentColor" stroke-width="2" stroke-dasharray="4 3"/></svg>
          </div>
          <div class="empty-title">No apps configured</div>
          <div class="empty-hint">Click “Add App” or “Popular Apps” in the toolbar above to get started.</div>
        </div>
      </section>

      <!-- Profiles page -->
      <section class="page" id="page-profiles">
        <div class="page-header">
          <div>
            <h1>Profiles</h1>
            <p>Group apps into profiles. Only the active profile’s apps are managed.</p>
          </div>
          <button class="btn btn-primary" id="add-profile-btn">
            <svg viewBox="0 0 16 16" fill="none" width="14" height="14"><path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            Add Profile
          </button>
        </div>
        <div class="profiles-list" id="profiles-list"></div>
        <div class="empty-state" id="profiles-empty" style="display:none">
          <div class="empty-title">No profiles</div>
        </div>
        <div class="hint-box" style="margin-top:16px">
          <svg viewBox="0 0 16 16" fill="none" width="14" height="14" style="flex-shrink:0;margin-top:1px"><circle cx="8" cy="8" r="6.5" stroke="currentColor" stroke-width="1.2"/><path d="M8 7v5M8 5v.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
          Trigger process names are matched case-insensitively against the Windows process list, e.g.
          <code>iRacingSim64DX11.exe</code>, <code>iRacingUI.exe</code>
        </div>
      </section>

      <!-- Settings page -->
      <section class="page" id="page-settings">
        <div class="page-header">
          <div class="page-header-text">
            <h1>Settings</h1>
            <p>Configure how iGnition behaves.</p>
          </div>
        </div>

        <div class="settings-cols">
          <!-- Left column -->
          <div class="settings-col">

            <div class="card">
              <div class="card-title">iRacing</div>
              <div class="form-group">
                <label class="form-label">Launch iRacing from</label>
                <div class="input-browse-row">
                  <input type="text" id="iracing-path" class="input" placeholder="Path to iRacingUI.exe…" />
                  <button class="btn btn-sm" id="browse-iracing-btn">Browse</button>
                </div>
                <p class="form-hint">Used by the Race button. Leave empty to use Steam (avoids the graphics settings prompt). Only needed for non-Steam installs.</p>
              </div>
              <div class="form-group" style="margin-top:20px">
                <label class="form-label">Start apps when</label>
                <div class="radio-group">
                  <label class="radio-label">
                    <input type="radio" name="trigger-mode" value="ui" class="radio" />
                    <div class="radio-content">
                      <span class="radio-title">iRacing UI opens</span>
                        <span class="radio-desc">Monitors <code>iRacingUI.exe</code>. Apps start when the iRacing service is open.</span>
                      </div>
                    </label>
                    <label class="radio-label">
                      <input type="radio" name="trigger-mode" value="race" class="radio" />
                      <div class="radio-content">
                        <span class="radio-title">Race starts</span>
                        <span class="radio-desc">Monitors <code>iRacingSim64DX11.exe</code>. Apps start when you enter a session.</span>
                    </div>
                  </label>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-title">Startup &amp; Tray</div>
              <div class="toggle-row">
                <div class="toggle-info">
                  <div class="toggle-label">Start with Windows</div>
                  <div class="toggle-desc">Runs iGnition at Windows login.</div>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="autostart-toggle" />
                  <span class="toggle-track"></span>
                </label>
              </div>
              <div class="inset-divider"></div>
              <div class="toggle-row">
                <div class="toggle-info">
                  <div class="toggle-label">Minimize to tray</div>
                  <div class="toggle-desc">Closing the window hides iGnition to the system tray.</div>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="minimize-tray" />
                  <span class="toggle-track"></span>
                </label>
              </div>
              <div class="inset-divider"></div>
              <div class="form-group" style="margin-top:16px">
                <label class="form-label">Windows notifications</label>
                <div class="radio-group">
                  <label class="radio-label">
                    <input type="radio" name="notification-mode" value="always" class="radio" checked />
                    <div class="radio-content">
                      <span class="radio-title">Enabled</span>
                      <span class="radio-desc">Show a toast when a session starts.</span>
                    </div>
                  </label>
                  <label class="radio-label">
                    <input type="radio" name="notification-mode" value="never" class="radio" />
                    <div class="radio-content">
                      <span class="radio-title">Disabled</span>
                      <span class="radio-desc">No Windows toast notifications.</span>
                    </div>
                  </label>
                </div>
              </div>
            </div>

          </div>

          <!-- Right column -->
          <div class="settings-col">

            <div class="card">
              <div class="card-title">Performance</div>
              <div class="form-group">
                <label class="form-label">Polling interval</label>
                <div class="input-with-unit" style="max-width:160px">
                  <input type="number" id="poll-interval" class="input" min="0.25" max="30" step="0.25" value="1.0" />
                  <span class="input-unit">sec</span>
                </div>
                <p class="form-hint">How often iGnition checks for running processes. Lower values react faster.</p>
              </div>
            </div>

            <div class="card">
              <div class="card-title">Configuration</div>
              <div class="button-group-v">
                <button class="btn" id="open-config-btn">Open Config Folder</button>
                <button class="btn" id="open-log-btn">Open Log Folder</button>
                <button class="btn" id="export-config-btn">Export Config&hellip;</button>
                <button class="btn" id="import-config-btn">Import Config&hellip;</button>
              </div>
              <div class="config-path-label" id="config-path-label"></div>
            </div>

          </div>
        </div>

        <div class="settings-save-bar">
          <button class="btn btn-primary" id="save-settings-btn">Save Settings</button>
        </div>
      </section>

      <!-- Log page -->
      <section class="page" id="page-log">
        <div class="page-header">
          <div>
            <h1>Log &amp; History</h1>
            <p>Live event feed and completed session history.</p>
          </div>
          <div class="log-header-actions">
            <div class="log-tabs" id="log-tabs">
              <button class="log-tab active" data-log-tab="events">Events</button>
              <button class="log-tab" data-log-tab="history">Sessions</button>
            </div>
            <button class="btn" id="clear-log-btn">Clear</button>
          </div>
        </div>
        <div id="log-events-panel">
          <div class="log-filter-bar" id="log-filter-bar">
            <button class="log-filter-btn active" data-filter="all">All</button>
            <button class="log-filter-btn" data-filter="error">Errors</button>
            <button class="log-filter-btn" data-filter="session">Session</button>
          </div>
          <div class="log-list" id="log-list">
            <div class="log-empty">No events yet. Start iRacing to see activity.</div>
          </div>
        </div>
        <div id="log-history-panel" style="display:none">
          <div class="session-list" id="session-list">
            <div class="log-empty">No sessions recorded yet.</div>
          </div>
          <div style="margin-top:12px">
            <button class="btn btn-sm" id="clear-history-btn">Clear History</button>
          </div>
        </div>
      </section>

    </main>
  </div><!-- #app -->

  <!-- Toast notification -->
  <div id="toast-container"></div>

  <!-- Edit App modal -->
  <div class="modal-backdrop" id="app-modal-backdrop">
    <div class="modal" id="app-modal">
      <div class="modal-header">
        <h2 class="modal-title" id="app-modal-title">Edit App</h2>
        <button class="modal-close" id="app-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="fm-app-id" />
        <div class="form-section-label">Identity</div>
        <div class="form-group">
          <label class="form-label">Display name <span class="required">*</span></label>
          <input type="text" id="fm-name" class="input" placeholder="e.g. CrewChief" />
        </div>
        <div class="form-group">
          <label class="form-label">Executable <span class="required">*</span></label>
          <div class="input-browse-row">
            <input type="text" id="fm-exe" class="input" placeholder="Path to .exe…" />
            <button class="btn btn-sm" id="fm-browse-exe">Browse</button>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Arguments</label>
          <input type="text" id="fm-args" class="input" placeholder="Optional command-line arguments" />
        </div>
        <div class="form-group">
          <label class="form-label">Working directory</label>
          <div class="input-browse-row">
            <input type="text" id="fm-wd" class="input" placeholder="Defaults to executable directory" />
            <button class="btn btn-sm" id="fm-browse-wd">Browse</button>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Start delay</label>
          <div class="input-with-unit" style="max-width:140px">
            <input type="number" id="fm-delay" class="input" min="0" max="600" step="0.5" value="0" />
            <span class="input-unit">sec</span>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Wait for process</label>
          <input type="text" id="fm-wait-for" class="input" placeholder="e.g. SimHub.exe (leave empty to start immediately)" />
          <p class="form-hint">This app will wait until the named process is running before it launches.</p>
        </div>
        <div class="form-group" id="fm-wait-timeout-group" style="display:none">
          <label class="form-label">Wait timeout</label>
          <div class="input-with-unit" style="max-width:140px">
            <input type="number" id="fm-wait-timeout" class="input" min="1" max="120" step="1" value="30" />
            <span class="input-unit">sec</span>
          </div>
        </div>

        <div class="form-section-label" style="margin-top:20px">Launch &amp; Lifecycle</div>
        <div class="options-grid">
          <label class="checkbox-label">
            <input type="checkbox" id="fm-start-min" class="checkbox" />
            <span>Launch window minimised</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="fm-allow-running" class="checkbox" />
            <span>Launch even if process already running</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="fm-kill-on-exit" class="checkbox" checked />
            <span>Terminate when iRacing exits</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="fm-kill-tree" class="checkbox" checked />
            <span>Kill entire process tree</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="fm-restart-on-crash" class="checkbox" />
            <span>Restart if process crashes during session</span>
          </label>
        </div>
        <div class="form-group" id="fm-max-restarts-group" style="display:none;margin-top:12px">
          <label class="form-label">Max restart attempts</label>
          <div class="input-with-unit" style="max-width:140px">
            <input type="number" id="fm-max-restarts" class="input" min="1" max="20" step="1" value="3" />
            <span class="input-unit">times</span>
          </div>
        </div>
        <div class="form-group" style="margin-top:12px">
          <label class="form-label">Shutdown grace period</label>
          <div class="input-with-unit" style="max-width:140px">
            <input type="number" id="fm-grace" class="input" min="0" max="30" step="0.5" value="0" />
            <span class="input-unit">sec</span>
          </div>
          <p class="form-hint">Wait this long for the app to close cleanly before force-killing it. 0 = instant kill.</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="app-modal-cancel">Cancel</button>
        <button class="btn btn-primary" id="app-modal-save">Save App</button>
      </div>
    </div>
  </div>

  <!-- Edit Triggers modal -->
  <div class="modal-backdrop" id="triggers-modal-backdrop">
    <div class="modal modal-sm" id="triggers-modal">
      <div class="modal-header">
        <h2 class="modal-title">Edit Trigger Processes</h2>
        <button class="modal-close" id="triggers-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="triggers-profile-id" />
        <div class="form-group">
          <label class="form-label">Start when</label>
          <div class="radio-group">
            <label class="radio-label">
              <input type="radio" name="trigger-mode-profile" value="ui" class="radio" />
              <div class="radio-content">
                <span class="radio-title">iRacing UI opens</span>
                <span class="radio-desc">Monitors <code>iRacingUI.exe</code></span>
              </div>
            </label>
            <label class="radio-label">
              <input type="radio" name="trigger-mode-profile" value="race" class="radio" />
              <div class="radio-content">
                <span class="radio-title">Race starts</span>
                <span class="radio-desc">Monitors <code>iRacingSim64DX11.exe</code></span>
              </div>
            </label>
            <label class="radio-label">
              <input type="radio" name="trigger-mode-profile" value="custom" class="radio" checked />
              <div class="radio-content">
                <span class="radio-title">Custom</span>
                <span class="radio-desc">Manually specify process names below</span>
              </div>
            </label>
          </div>
        </div>
        <div class="form-group" id="triggers-custom-group">
          <label class="form-label">
            Comma-separated process names
          </label>
          <input type="text" id="triggers-input" class="input"
            placeholder="iRacingSim64DX11.exe, iRacingUI.exe" />
          <p class="form-hint">Separate multiple names with commas. Matched case-insensitively.</p>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="triggers-modal-cancel">Cancel</button>
        <button class="btn btn-primary" id="triggers-modal-save">Save</button>
      </div>
    </div>
  </div>

  <!-- Confirm dialog -->
  <div class="modal-backdrop" id="confirm-backdrop">
    <div class="modal modal-sm" id="confirm-modal">
      <div class="modal-header">
        <h2 class="modal-title" id="confirm-title">Confirm</h2>
      </div>
      <div class="modal-body">
        <p id="confirm-message" class="confirm-msg"></p>
      </div>
      <div class="modal-footer">
        <button class="btn" id="confirm-cancel">Cancel</button>
        <button class="btn btn-danger" id="confirm-ok">Confirm</button>
      </div>
    </div>
  </div>

  <!-- Text input modal (replaces window.prompt) -->
  <div class="modal-backdrop" id="input-modal-backdrop">
    <div class="modal modal-sm" id="input-modal">
      <div class="modal-header">
        <h2 class="modal-title" id="input-modal-title">Enter name</h2>
        <button class="modal-close" id="input-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group" style="margin:0">
          <input type="text" id="input-modal-input" class="input" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="input-modal-cancel">Cancel</button>
        <button class="btn btn-primary" id="input-modal-ok">OK</button>
      </div>
    </div>
  </div>

  <!-- Template picker modal -->
  <div class="modal-backdrop" id="template-modal-backdrop">
    <div class="modal" id="template-modal">
      <div class="modal-header">
        <h2 class="modal-title">Popular Apps</h2>
        <button class="modal-close" id="template-modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <p style="color:var(--text-secondary);font-size:13px;margin:0 0 14px">Found on this PC. Select apps to add to the active profile.</p>
        <div class="template-list" id="template-list"></div>
        <div class="log-empty" id="template-empty" style="display:none">No popular apps found on this PC. Try adding apps manually.</div>
      </div>
      <div class="modal-footer">
        <button class="btn" id="template-modal-cancel">Cancel</button>
        <button class="btn btn-primary" id="template-modal-add">Add Selected</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
